-- Robloxæ‰‹æœºç«¯é«˜çº§åŠŸèƒ½èœå•è„šæœ¬ï¼ˆä¿®å¤ç‰ˆï¼‰
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local GuiService = game:GetService("GuiService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local touchEnabled = UserInputService.TouchEnabled

-- æ£€æŸ¥æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
if not touchEnabled then
    warn("æ­¤è„šæœ¬ä¸“ä¸ºç§»åŠ¨è®¾å¤‡è®¾è®¡")
    return
end

-- å®‰å…¨çš„loadstringå‡½æ•°ï¼ˆå…¼å®¹ä¸åŒç¯å¢ƒï¼‰
local function safeLoadstring(code)
    local success, result = pcall(function()
        -- å°è¯•å¤šç§loadstringæ–¹å¼
        if loadstring then
            return loadstring(code)
        elseif load then
            return load(code)
        else
            -- å¦‚æœéƒ½æ²¡æœ‰ï¼Œå°è¯•ç›´æ¥æ‰§è¡Œ
            return function() 
                local func, err = loadstring(code)
                if func then return func() end
                error(err or "æ— æ³•åŠ è½½è„šæœ¬")
            end
        end
    end)
    
    if success and result then
        return result
    else
        return function() 
            warn("è„šæœ¬åŠ è½½å¤±è´¥: " .. tostring(result))
        end
    end
end

-- å®‰å…¨çš„HTTPè·å–å‡½æ•°
local function safeHttpGet(url)
    local success, result = pcall(function()
        return game:HttpGet(url, true)
    end)
    
    if success then
        return result
    else
        -- å¤‡ç”¨æ–¹æ¡ˆ
        local success2, result2 = pcall(function()
            return HttpService:GetAsync(url)
        end)
        
        if success2 then
            return result2
        else
            return "print('è„šæœ¬åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥')"
        end
    end
end

-- æ£€æŸ¥è„šæœ¬æ˜¯å¦å·²æ°¸ä¹…å…³é—­
local permanentClose = false

-- åˆ›å»ºä¸»GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MobileAdvancedMenu"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- åˆ›å»ºæ‰“å¼€èœå•çš„æµ®åŠ¨æŒ‰é’®
local OpenButton = Instance.new("ImageButton")
OpenButton.Name = "OpenButton"
OpenButton.Size = UDim2.new(0, 60, 0, 60)
OpenButton.Position = UDim2.new(0, 20, 0.5, -30)
OpenButton.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
OpenButton.Image = "rbxassetid://7072717834"
OpenButton.Parent = ScreenGui

local OpenButtonCorner = Instance.new("UICorner")
OpenButtonCorner.CornerRadius = UDim.new(1, 0)
OpenButtonCorner.Parent = OpenButton

-- åˆ›å»ºèƒŒæ™¯é®ç½©
local Background = Instance.new("Frame")
Background.Name = "Background"
Background.Size = UDim2.new(1, 0, 1, 0)
Background.BackgroundColor3 = Color3.new(0, 0, 0)
Background.BackgroundTransparency = 0.7
Background.Visible = false
Background.Parent = ScreenGui

-- åˆ›å»ºä¸»çª—å£
local MainWindow = Instance.new("Frame")
MainWindow.Name = "MainWindow"
MainWindow.Size = UDim2.new(0.9, 0, 0, 450)
MainWindow.Position = UDim2.new(0.5, 0, 0.5, 0)
MainWindow.AnchorPoint = Vector2.new(0.5, 0.5)
MainWindow.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainWindow.BorderSizePixel = 0
MainWindow.Visible = false
MainWindow.Parent = ScreenGui

-- åœ†è§’æ•ˆæœ
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 15)
UICorner.Parent = MainWindow

-- æ ‡é¢˜æ 
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 50)
TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainWindow

local TitleBarCorner = Instance.new("UICorner")
TitleBarCorner.CornerRadius = UDim.new(0, 15)
TitleBarCorner.Parent = TitleBar

-- æ ‡é¢˜æ–‡å­—
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(1, -100, 1, 0)
TitleLabel.Position = UDim2.new(0, 20, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "ğŸ“± æ‰‹æœºåŠŸèƒ½èœå•"
TitleLabel.TextColor3 = Color3.new(1, 1, 1)
TitleLabel.TextSize = 20
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

-- å…³é—­æŒ‰é’®
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 40, 0, 40)
CloseButton.Position = UDim2.new(1, -50, 0.5, -20)
CloseButton.AnchorPoint = Vector2.new(0.5, 0.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.Text = "Ã—"
CloseButton.TextSize = 24
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CloseButtonCorner = Instance.new("UICorner")
CloseButtonCorner.CornerRadius = UDim.new(0, 8)
CloseButtonCorner.Parent = CloseButton

-- å†…å®¹åŒºåŸŸ
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -20, 1, -70)
ContentFrame.Position = UDim2.new(0, 10, 0, 60)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainWindow

-- åˆ†ç±»æ ‡é¢˜
local CategoryLabel = Instance.new("TextLabel")
CategoryLabel.Name = "CategoryLabel"
CategoryLabel.Size = UDim2.new(1, 0, 0, 35)
CategoryLabel.BackgroundTransparency = 1
CategoryLabel.Text = "ğŸ“‹ é€šç”¨åŠŸèƒ½"
CategoryLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
CategoryLabel.TextSize = 18
CategoryLabel.Font = Enum.Font.GothamBold
CategoryLabel.TextXAlignment = Enum.TextXAlignment.Left
CategoryLabel.Parent = ContentFrame

-- åŠŸèƒ½æŒ‰é’®å®¹å™¨
local ButtonsContainer = Instance.new("ScrollingFrame")
ButtonsContainer.Name = "ButtonsContainer"
ButtonsContainer.Size = UDim2.new(1, 0, 1, -40)
ButtonsContainer.Position = UDim2.new(0, 0, 0, 40)
ButtonsContainer.BackgroundTransparency = 1
ButtonsContainer.BorderSizePixel = 0
ButtonsContainer.ScrollBarThickness = 6
ButtonsContainer.ScrollingDirection = Enum.ScrollingDirection.Y
ButtonsContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
ButtonsContainer.Parent = ContentFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 12)
UIListLayout.Parent = ButtonsContainer

-- åˆ›å»ºçŠ¶æ€æ˜¾ç¤ºæ ‡ç­¾
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(1, 0, 0, 25)
StatusLabel.Position = UDim2.new(0, 0, 1, 5)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "å°±ç»ª"
StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
StatusLabel.TextSize = 12
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Visible = false
StatusLabel.Parent = ContentFrame

-- åˆ›å»ºæ‰‹æœºä¼˜åŒ–çš„åŠŸèƒ½æŒ‰é’®
local function createMobileFeatureButton(text, description, scriptUrl, isR15Only)
    local ButtonFrame = Instance.new("Frame")
    ButtonFrame.Size = UDim2.new(1, 0, 0, 80)
    ButtonFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    ButtonFrame.BorderSizePixel = 0
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 10)
    ButtonCorner.Parent = ButtonFrame
    
    local Button = Instance.new("TextButton")
    Button.Name = "Button"
    Button.Size = UDim2.new(1, 0, 1, 0)
    Button.BackgroundTransparency = 1
    Button.Text = ""
    Button.Parent = ButtonFrame
    
    local ButtonIcon = Instance.new("ImageLabel")
    ButtonIcon.Name = "ButtonIcon"
    ButtonIcon.Size = UDim2.new(0, 40, 0, 40)
    ButtonIcon.Position = UDim2.new(0, 15, 0.5, -20)
    ButtonIcon.BackgroundTransparency = 1
    ButtonIcon.Image = "rbxassetid://7072717834"
    ButtonIcon.Parent = ButtonFrame
    
    local ButtonTitle = Instance.new("TextLabel")
    ButtonTitle.Name = "ButtonTitle"
    ButtonTitle.Size = UDim2.new(1, -80, 0, 30)
    ButtonTitle.Position = UDim2.new(0, 70, 0, 15)
    ButtonTitle.BackgroundTransparency = 1
    ButtonTitle.Text = text
    ButtonTitle.TextColor3 = Color3.new(1, 1, 1)
    ButtonTitle.TextSize = 16
    ButtonTitle.Font = Enum.Font.GothamBold
    ButtonTitle.TextXAlignment = Enum.TextXAlignment.Left
    ButtonTitle.Parent = ButtonFrame
    
    local ButtonDesc = Instance.new("TextLabel")
    ButtonDesc.Name = "ButtonDesc"
    ButtonDesc.Size = UDim2.new(1, -80, 0, 20)
    ButtonDesc.Position = UDim2.new(0, 70, 0, 45)
    ButtonDesc.BackgroundTransparency = 1
    ButtonDesc.Text = description
    ButtonDesc.TextColor3 = Color3.fromRGB(180, 180, 180)
    ButtonDesc.TextSize = 12
    ButtonDesc.Font = Enum.Font.Gotham
    ButtonDesc.TextXAlignment = Enum.TextXAlignment.Left
    ButtonDesc.Parent = ButtonFrame
    
    if isR15Only then
        local R15Label = Instance.new("TextLabel")
        R15Label.Name = "R15Label"
        R15Label.Size = UDim2.new(0, 70, 0, 20)
        R15Label.Position = UDim2.new(1, -75, 0.5, -10)
        R15Label.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
        R15Label.Text = "ä»…é™R15"
        R15Label.TextColor3 = Color3.new(1, 1, 1)
        R15Label.TextSize = 11
        R15Label.Font = Enum.Font.GothamBold
        R15Label.Parent = ButtonFrame
        
        local R15Corner = Instance.new("UICorner")
        R15Corner.CornerRadius = UDim.new(0, 5)
        R15Corner.Parent = R15Label
    end
    
    -- æŒ‰é’®ç‚¹å‡»æ•ˆæœ
    Button.MouseButton1Click:Connect(function()
        -- æ˜¾ç¤ºçŠ¶æ€
        StatusLabel.Visible = true
        StatusLabel.Text = "æ­£åœ¨åŠ è½½è„šæœ¬..."
        StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
        
        -- ç‚¹å‡»åé¦ˆ
        TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(60, 60, 70)}):Play()
        wait(0.1)
        TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(40, 40, 50)}):Play()
        
        -- å»¶è¿Ÿæ‰§è¡Œä»¥é¿å…UIå¡é¡¿
        wait(0.1)
        
        -- æ‰§è¡Œè„šæœ¬
        local success, err = pcall(function()
            if scriptUrl then
                StatusLabel.Text = "ä¸‹è½½è„šæœ¬ä¸­..."
                
                -- è·å–è„šæœ¬ä»£ç 
                local scriptCode = safeHttpGet(scriptUrl)
                
                StatusLabel.Text = "æ‰§è¡Œè„šæœ¬ä¸­..."
                
                -- åŠ è½½å¹¶æ‰§è¡Œè„šæœ¬
                local scriptFunction = safeLoadstring(scriptCode)
                if scriptFunction then
                    scriptFunction()
                    StatusLabel.Text = "è„šæœ¬æ‰§è¡ŒæˆåŠŸ!"
                    StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                    
                    -- 3ç§’åéšè—çŠ¶æ€
                    delay(3, function()
                        if StatusLabel then
                            StatusLabel.Visible = false
                        end
                    end)
                else
                    error("æ— æ³•åŠ è½½è„šæœ¬å‡½æ•°")
                end
            else
                -- å¦‚æœæ²¡æœ‰URLï¼Œæ‰§è¡Œå†…ç½®åŠŸèƒ½
                if text == "é£è¡ŒåŠŸèƒ½" then
                    StatusLabel.Text = "æ¿€æ´»é£è¡Œæ¨¡å¼..."
                    -- è¿™é‡Œå¯ä»¥æ·»åŠ å†…ç½®çš„é£è¡Œè„šæœ¬
                    loadstring(game:HttpGet("https://raw.githubusercontent.com/396abc/Script/refs/heads/main/MobileFly.lua"))()
                elseif text == "æ— æ•Œæ¨¡å¼" then
                    StatusLabel.Text = "æ¿€æ´»æ— æ•Œæ¨¡å¼..."
                    -- è¿™é‡Œå¯ä»¥æ·»åŠ å†…ç½®çš„æ— æ•Œè„šæœ¬
                end
            end
        end)
        
        if not success then
            StatusLabel.Text = "é”™è¯¯: " .. tostring(err)
            StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            warn("è„šæœ¬æ‰§è¡Œé”™è¯¯: " .. tostring(err))
            
            -- 5ç§’åéšè—çŠ¶æ€
            delay(5, function()
                if StatusLabel then
                    StatusLabel.Visible = false
                end
            end)
        end
    end)
    
    -- æ‚¬åœæ•ˆæœ
    Button.MouseEnter:Connect(function()
        TweenService:Create(ButtonFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
    end)
    
    Button.MouseLeave:Connect(function()
        TweenService:Create(ButtonFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 50)}):Play()
    end)
    
    return ButtonFrame
end

-- æ·»åŠ åŠŸèƒ½æŒ‰é’®ï¼ˆä½¿ç”¨æ­£ç¡®çš„URLï¼‰
local mobileFlyButton = createMobileFeatureButton("é£è¡ŒåŠŸèƒ½", "è§¦æ‘¸æ§åˆ¶é£è¡Œ", "https://raw.githubusercontent.com/396abc/Script/refs/heads/main/MobileFly.lua", true)
mobileFlyButton.Parent = ButtonsContainer

local godButton = createMobileFeatureButton("æ— æ•Œæ¨¡å¼", "è§’è‰²æ— æ•ŒçŠ¶æ€", "https://raw.githubusercontent.com/396abc/Script/refs/heads/main/MobileGodMode.lua", false)
godButton.Parent = ButtonsContainer

local speedButton = createMobileFeatureButton("ç§»åŠ¨åŠ é€Ÿ", "æå‡ç§»åŠ¨é€Ÿåº¦", "https://raw.githubusercontent.com/396abc/Script/refs/heads/main/MobileSpeed.lua", false)
speedButton.Parent = ButtonsContainer

local noclipButton = createMobileFeatureButton("ç©¿å¢™æ¨¡å¼", "ç©¿é€ç‰©ä½“", "https://raw.githubusercontent.com/396abc/Script/refs/heads/main/MobileNoclip.lua", false)
noclipButton.Parent = ButtonsContainer

-- å¤‡ç”¨å†…ç½®åŠŸèƒ½æŒ‰é’®ï¼ˆå¦‚æœURLä¸å¯ç”¨ï¼‰
local simpleFlyButton = createMobileFeatureButton("ç®€æ˜“é£è¡Œ", "åŸºç¡€é£è¡ŒåŠŸèƒ½", nil, true)
simpleFlyButton.Parent = ButtonsContainer

-- æ›´æ–°æ»šåŠ¨åŒºåŸŸå¤§å°
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ButtonsContainer.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 10)
end)

-- æ‰‹æœºç«¯æ‹–åŠ¨åŠŸèƒ½
local dragging = false
local dragStart
local startPos

local function updateTouch(input)
    if dragging then
        local delta = input.Position - dragStart
        MainWindow.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainWindow.Position
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end

UserInputService.TouchMoved:Connect(updateTouch)

-- æ˜¾ç¤º/éšè—èœå•
local function toggleMenu()
    if permanentClose then return end
    
    local isVisible = Background.Visible
    
    if isVisible then
        -- éšè—åŠ¨ç”»
        TweenService:Create(MainWindow, TweenInfo.new(0.3), {Size = UDim2.new(0, 0, 0, 450)}):Play()
        TweenService:Create(Background, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
        wait(0.3)
        Background.Visible = false
        MainWindow.Visible = false
        OpenButton.Visible = true
    else
        -- æ˜¾ç¤ºåŠ¨ç”»
        OpenButton.Visible = false
        Background.Visible = true
        MainWindow.Visible = true
        MainWindow.Size = UDim2.new(0, 0, 0, 450)
        TweenService:Create(MainWindow, TweenInfo.new(0.3), {Size = UDim2.new(0.9, 0, 0, 450)}):Play()
        TweenService:Create(Background, TweenInfo.new(0.3), {BackgroundTransparency = 0.7}):Play()
    end
end

-- æ‰“å¼€æŒ‰é’®åŠŸèƒ½
OpenButton.MouseButton1Click:Connect(function()
    toggleMenu()
end)

-- å…³é—­æŒ‰é’®åŠŸèƒ½
CloseButton.MouseButton1Click:Connect(function()
    permanentClose = true
    TweenService:Create(MainWindow, TweenInfo.new(0.3), {Size = UDim2.new(0, 0, 0, 450)}):Play()
    TweenService:Create(Background, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
    TweenService:Create(OpenButton, TweenInfo.new(0.3), {BackgroundTransparency = 1, ImageTransparency = 1}):Play()
    wait(0.3)
    ScreenGui:Destroy()
end)

-- èƒŒæ™¯ç‚¹å‡»å…³é—­
Background.MouseButton1Click:Connect(function()
    toggleMenu()
end)

-- é€‚é…æ‰‹æœºå±å¹•å®‰å…¨åŒºåŸŸ
local function updateSafeZone()
    local safeArea = GuiService:GetGuiInset()
    MainWindow.Position = UDim2.new(0.5, 0, 0.5, safeArea.Y)
    OpenButton.Position = UDim2.new(0, 20, 0.5, -30 + safeArea.Y)
end

-- åˆå§‹è®¾ç½®
ScreenGui.Parent = player:WaitForChild("PlayerGui")
updateSafeZone()

-- å±å¹•å°ºå¯¸å˜åŒ–æ—¶æ›´æ–°å®‰å…¨åŒºåŸŸ
GuiService:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateSafeZone)

print("ğŸ“± æ‰‹æœºç«¯é«˜çº§åŠŸèƒ½èœå•å·²åŠ è½½ï¼")
print("ç‚¹å‡»å±å¹•å·¦ä¾§çš„è“è‰²æŒ‰é’®æ‰“å¼€èœå•")

-- æ˜¾ç¤ºå°±ç»ªçŠ¶æ€
StatusLabel.Visible = true
StatusLabel.Text = "èœå•åŠ è½½å®Œæˆ"
delay(2, function()
    if StatusLabel then
        StatusLabel.Visible = false
    end
end)

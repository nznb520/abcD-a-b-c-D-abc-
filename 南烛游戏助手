-- Roblox高级功能菜单脚本
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- 检查脚本是否已永久关闭
local permanentClose = false

-- 创建主GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AdvancedMenu"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- 创建背景遮罩
local Background = Instance.new("Frame")
Background.Name = "Background"
Background.Size = UDim2.new(1, 0, 1, 0)
Background.BackgroundColor3 = Color3.new(0, 0, 0)
Background.BackgroundTransparency = 0.5
Background.Visible = false
Background.Parent = ScreenGui

-- 创建主窗口
local MainWindow = Instance.new("Frame")
MainWindow.Name = "MainWindow"
MainWindow.Size = UDim2.new(0, 350, 0, 400)
MainWindow.Position = UDim2.new(0.5, -175, 0.5, -200)
MainWindow.AnchorPoint = Vector2.new(0.5, 0.5)
MainWindow.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainWindow.BorderSizePixel = 0
MainWindow.Visible = false
MainWindow.Parent = ScreenGui

-- 圆角效果
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainWindow

-- 标题栏
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainWindow

local TitleBarCorner = Instance.new("UICorner")
TitleBarCorner.CornerRadius = UDim.new(0, 12)
TitleBarCorner.Parent = TitleBar

-- 标题文字
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(1, -80, 1, 0)
TitleLabel.Position = UDim2.new(0, 15, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "高级功能菜单"
TitleLabel.TextColor3 = Color3.new(1, 1, 1)
TitleLabel.TextSize = 18
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

-- 关闭按钮
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0.5, -15)
CloseButton.AnchorPoint = Vector2.new(0.5, 0.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.Text = "×"
CloseButton.TextSize = 20
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CloseButtonCorner = Instance.new("UICorner")
CloseButtonCorner.CornerRadius = UDim.new(0, 6)
CloseButtonCorner.Parent = CloseButton

-- 最小化按钮
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -70, 0.5, -15)
MinimizeButton.AnchorPoint = Vector2.new(0.5, 0.5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
MinimizeButton.TextColor3 = Color3.new(1, 1, 1)
MinimizeButton.Text = "_"
MinimizeButton.TextSize = 16
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Parent = TitleBar

local MinimizeButtonCorner = Instance.new("UICorner")
MinimizeButtonCorner.CornerRadius = UDim.new(0, 6)
MinimizeizeButtonCorner.Parent = MinimizeButton

-- 内容区域
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -20, 1, -60)
ContentFrame.Position = UDim2.new(0, 10, 0, 50)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainWindow

-- 分类标题
local CategoryLabel = Instance.new("TextLabel")
CategoryLabel.Name = "CategoryLabel"
CategoryLabel.Size = UDim2.new(1, 0, 0, 30)
CategoryLabel.BackgroundTransparency = 1
CategoryLabel.Text = "通用类型"
CategoryLabel.TextColor3 = Color3.fromRGB(100, 150, 255)
CategoryLabel.TextSize = 16
CategoryLabel.Font = Enum.Font.GothamBold
CategoryLabel.TextXAlignment = Enum.TextXAlignment.Left
CategoryLabel.Parent = ContentFrame

-- 功能按钮容器
local ButtonsContainer = Instance.new("ScrollingFrame")
ButtonsContainer.Name = "ButtonsContainer"
ButtonsContainer.Size = UDim2.new(1, 0, 1, -40)
ButtonsContainer.Position = UDim2.new(0, 0, 0, 35)
ButtonsContainer.BackgroundTransparency = 1
ButtonsContainer.BorderSizePixel = 0
ButtonsContainer.ScrollBarThickness = 4
ButtonsContainer.CanvasSize = UDim2.new(0, 0, 0, 200)
ButtonsContainer.Parent = ContentFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 10)
UIListLayout.Parent = ButtonsContainer

-- 创建功能按钮
local function createFeatureButton(text, description, scriptUrl, isR15Only)
    local ButtonFrame = Instance.new("Frame")
    ButtonFrame.Size = UDim2.new(1, 0, 0, 70)
    ButtonFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    ButtonFrame.BorderSizePixel = 0
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 8)
    ButtonCorner.Parent = ButtonFrame
    
    local Button = Instance.new("TextButton")
    Button.Name = "Button"
    Button.Size = UDim2.new(1, 0, 1, 0)
    Button.BackgroundTransparency = 1
    Button.Text = ""
    Button.Parent = ButtonFrame
    
    local ButtonTitle = Instance.new("TextLabel")
    ButtonTitle.Name = "ButtonTitle"
    ButtonTitle.Size = UDim2.new(1, -20, 0, 25)
    ButtonTitle.Position = UDim2.new(0, 10, 0, 5)
    ButtonTitle.BackgroundTransparency = 1
    ButtonTitle.Text = text
    ButtonTitle.TextColor3 = Color3.new(1, 1, 1)
    ButtonTitle.TextSize = 14
    ButtonTitle.Font = Enum.Font.GothamBold
    ButtonTitle.TextXAlignment = Enum.TextXAlignment.Left
    ButtonTitle.Parent = ButtonFrame
    
    local ButtonDesc = Instance.new("TextLabel")
    ButtonDesc.Name = "ButtonDesc"
    ButtonDesc.Size = UDim2.new(1, -20, 0, 20)
    ButtonDesc.Position = UDim2.new(0, 10, 0, 30)
    ButtonDesc.BackgroundTransparency = 1
    ButtonDesc.Text = description
    ButtonDesc.TextColor3 = Color3.fromRGB(200, 200, 200)
    ButtonDesc.TextSize = 12
    ButtonDesc.Font = Enum.Font.Gotham
    ButtonDesc.TextXAlignment = Enum.TextXAlignment.Left
    ButtonDesc.Parent = ButtonFrame
    
    if isR15Only then
        local R15Label = Instance.new("TextLabel")
        R15Label.Name = "R15Label"
        R15Label.Size = UDim2.new(0, 60, 0, 16)
        R15Label.Position = UDim2.new(1, -70, 1, -20)
        R15Label.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
        R15Label.Text = "仅限R15"
        R15Label.TextColor3 = Color3.new(1, 1, 1)
        R15Label.TextSize = 10
        R15Label.Font = Enum.Font.Gotham
        R15Label.Parent = ButtonFrame
        
        local R15Corner = Instance.new("UICorner")
        R15Corner.CornerRadius = UDim.new(0, 4)
        R15Corner.Parent = R15Label
    end
    
    Button.MouseButton1Click:Connect(function()
        if scriptUrl then
            loadstring(game:HttpGet(scriptUrl))()
        end
    end)
    
    -- 悬停效果
    Button.MouseEnter:Connect(function()
        TweenService:Create(ButtonFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
    end)
    
    Button.MouseLeave:Connect(function()
        TweenService:Create(ButtonFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 50)}):Play()
    end)
    
    return ButtonFrame
end

-- 添加功能按钮
local flyButton = createFeatureButton("飞行功能", "启用角色飞行能力", "https://raw.githubusercontent.com/396abc/Script/refs/heads/main/FlyR15.lua", true)
flyButton.Parent = ButtonsContainer

local godButton = createFeatureButton("无敌模式", "使角色无敌", "https://raw.githubusercontent.com/396abc/Script/refs/heads/main/GodMode.lua", false)
godButton.Parent = ButtonsContainer

local speedButton = createFeatureButton("超级速度", "极大提升移动速度", "https://raw.githubusercontent.com/396abc/Script/refs/heads/main/SuperSpeed.lua", false)
speedButton.Parent = ButtonsContainer

-- 更新滚动区域大小
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ButtonsContainer.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y)
end)

-- 拖动功能
local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainWindow.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainWindow.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- 显示/隐藏菜单
local function toggleMenu()
    if permanentClose then return end
    
    local isVisible = Background.Visible
    
    if isVisible then
        -- 隐藏动画
        Background.Visible = false
        TweenService:Create(MainWindow, TweenInfo.new(0.3), {Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0)}):Play()
        wait(0.3)
        MainWindow.Visible = false
    else
        -- 显示动画
        Background.Visible = true
        MainWindow.Visible = true
        MainWindow.Size = UDim2.new(0, 0, 0, 0)
        TweenService:Create(MainWindow, TweenInfo.new(0.3), {Size = UDim2.new(0, 350, 0, 400), Position = UDim2.new(0.5, -175, 0.5, -200)}):Play()
    end
end

-- 关闭按钮功能
CloseButton.MouseButton1Click:Connect(function()
    permanentClose = true
    TweenService:Create(MainWindow, TweenInfo.new(0.3), {Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0)}):Play()
    TweenService:Create(Background, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
    wait(0.3)
    ScreenGui:Destroy()
end)

-- 最小化按钮功能
MinimizeButton.MouseButton1Click:Connect(function()
    toggleMenu()
end)

-- 背景点击关闭
Background.MouseButton1Click:Connect(function()
    toggleMenu()
end)

-- 绑定快捷键（F键打开菜单）
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F then
        toggleMenu()
    end
end)

ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- 初始显示菜单
toggleMenu()

print("高级功能菜单已加载！按 F 键打开/关闭菜单")

-- NZ脚本中心 - Roblox本地脚本
-- 作者: 南烛

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- 创建主ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "NZScriptCenter"
screenGui.ResetOnSpawn = false

-- 欢迎界面函数
local function createWelcomeScreen()
    local welcomeFrame = Instance.new("Frame")
    welcomeFrame.Size = UDim2.new(1, 0, 1, 0)
    welcomeFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    welcomeFrame.Parent = screenGui
    
    local backgroundImage = Instance.new("ImageLabel")
    backgroundImage.Image = "rbxassetid://123947581167369"
    backgroundImage.Size = UDim2.new(0.6, 0, 0.4, 0)
    backgroundImage.Position = UDim2.new(0.2, 0, 0.2, 0)
    backgroundImage.BackgroundTransparency = 1
    backgroundImage.Parent = welcomeFrame
    
    local welcomeText = Instance.new("TextLabel")
    welcomeText.Text = "欢迎使用NZ脚本中心"
    welcomeText.Size = UDim2.new(0.6, 0, 0.1, 0)
    welcomeText.Position = UDim2.new(0.2, 0, 0.65, 0)
    welcomeText.BackgroundTransparency = 1
    welcomeText.TextColor3 = Color3.new(1, 1, 1)
    welcomeText.TextScaled = true
    welcomeText.Font = Enum.Font.GothamBold
    welcomeText.Parent = welcomeFrame
    
    -- 等待3秒后关闭欢迎界面
    wait(3)
    
    local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut)
    local tween = TweenService:Create(welcomeFrame, tweenInfo, {BackgroundTransparency = 1})
    tween:Play()
    tween.Completed:Connect(function()
        welcomeFrame:Destroy()
        createMainInterface()
    end)
end

-- 创建主界面
local function createMainInterface()
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0.8, 0, 0.8, 0)
    mainFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
    mainFrame.BackgroundTransparency = 0.9
    mainFrame.BackgroundColor3 = Color3.new(0.05, 0.05, 0.05)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    -- 背景图
    local background = Instance.new("ImageLabel")
    background.Image = "rbxassetid://105529853851343"
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundTransparency = 1
    background.Parent = mainFrame
    
    -- 标题区域
    local titleFrame = Instance.new("Frame")
    titleFrame.Size = UDim2.new(1, 0, 0.1, 0)
    titleFrame.BackgroundTransparency = 1
    titleFrame.Parent = mainFrame
    
    local title = Instance.new("TextLabel")
    title.Text = "NZ脚本中心"
    title.Size = UDim2.new(1, 0, 0.7, 0)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.new(1, 1, 1)
    title.TextScaled = true
    title.Font = Enum.Font.GothamBlack
    title.TextStrokeTransparency = 0.5
    title.TextStrokeColor3 = Color3.new(0, 0, 0)
    title.Parent = titleFrame
    
    local author = Instance.new("TextLabel")
    author.Text = "作者:南烛"
    author.Size = UDim2.new(1, 0, 0.3, 0)
    author.Position = UDim2.new(0, 0, 0.7, 0)
    author.BackgroundTransparency = 1
    author.TextColor3 = Color3.new(0.8, 0.8, 0.8)
    author.TextScaled = true
    author.Font = Enum.Font.Gotham
    author.Parent = titleFrame
    
    -- 控制按钮（右上角）
    local controlFrame = Instance.new("Frame")
    controlFrame.Size = UDim2.new(0.1, 0, 0.05, 0)
    controlFrame.Position = UDim2.new(0.9, 0, 0, 0)
    controlFrame.BackgroundTransparency = 1
    controlFrame.Parent = mainFrame
    
    local minimizeButton = Instance.new("TextButton")
    minimizeButton.Text = "_"
    minimizeButton.Size = UDim2.new(0.4, 0, 1, 0)
    minimizeButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.8)
    minimizeButton.TextColor3 = Color3.new(1, 1, 1)
    minimizeButton.Font = Enum.Font.GothamBold
    minimizeButton.Parent = controlFrame
    
    local closeButton = Instance.new("TextButton")
    closeButton.Text = "X"
    closeButton.Size = UDim2.new(0.4, 0, 1, 0)
    closeButton.Position = UDim2.new(0.5, 0, 0, 0)
    closeButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    closeButton.TextColor3 = Color3.new(1, 1, 1)
    closeButton.Font = Enum.Font.GothamBold
    closeButton.Parent = controlFrame
    
    -- 导航栏容器
    local navContainer = Instance.new("Frame")
    navContainer.Size = UDim2.new(1, 0, 0.9, 0)
    navContainer.Position = UDim2.new(0, 0, 0.1, 0)
    navContainer.BackgroundTransparency = 1
    navContainer.Parent = mainFrame
    
    -- 左侧小导航栏（类型选择）
    local leftNav = Instance.new("Frame")
    leftNav.Size = UDim2.new(0.2, 0, 1, 0)
    leftNav.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    leftNav.BackgroundTransparency = 0.3
    leftNav.BorderSizePixel = 0
    leftNav.Parent = navContainer
    
    -- 右侧大导航栏（功能显示）
    local rightNav = Instance.new("Frame")
    rightNav.Size = UDim2.new(0.8, 0, 1, 0)
    rightNav.Position = UDim2.new(0.2, 0, 0, 0)
    rightNav.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
    rightNav.BackgroundTransparency = 0.2
    rightNav.BorderSizePixel = 0
    rightNav.Parent = navContainer
    
    -- 类型按钮
    local function createTypeButton(text, yPosition)
        local button = Instance.new("TextButton")
        button.Text = text
        button.Size = UDim2.new(1, 0, 0.2, 0)
        button.Position = UDim2.new(0, 0, yPosition, 0)
        button.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
        button.BackgroundTransparency = 0.5
        button.TextColor3 = Color3.new(1, 1, 1)
        button.Font = Enum.Font.Gotham
        button.TextScaled = true
        button.Parent = leftNav
        
        return button
    end
    
    local generalButton = createTypeButton("通用功能", 0)
    local espButton = createTypeButton("ESP类型", 0.2)
    local ninjaButton = createTypeButton("忍者传奇", 0.4)
    
    -- 功能变量
    local infiniteJumpEnabled = false
    local espEnabled = false
    local autoSwingEnabled = false
    local espHighlights = {}
    
    -- 无限跳跃功能
    local function setupInfiniteJump()
        local jumpFrame = Instance.new("Frame")
        jumpFrame.Size = UDim2.new(1, 0, 1, 0)
        jumpFrame.BackgroundTransparency = 1
        jumpFrame.Visible = false
        jumpFrame.Parent = rightNav
        
        local title = Instance.new("TextLabel")
        title.Text = "无限跳"
        title.Size = UDim2.new(1, 0, 0.1, 0)
        title.BackgroundTransparency = 1
        title.TextColor3 = Color3.new(1, 1, 1)
        title.TextScaled = true
        title.Font = Enum.Font.GothamBold
        title.Parent = jumpFrame
        
        local toggleButton = Instance.new("TextButton")
        toggleButton.Text = "关闭"
        toggleButton.Size = UDim2.new(0.3, 0, 0.1, 0)
        toggleButton.Position = UDim2.new(0.35, 0, 0.2, 0)
        toggleButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
        toggleButton.TextColor3 = Color3.new(1, 1, 1)
        toggleButton.Font = Enum.Font.Gotham
        toggleButton.TextScaled = true
        toggleButton.Parent = jumpFrame
        
        local function onJumpRequest()
            if infiniteJumpEnabled then
                local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end
        
        toggleButton.MouseButton1Click:Connect(function()
            infiniteJumpEnabled = not infiniteJumpEnabled
            if infiniteJumpEnabled then
                toggleButton.Text = "开启"
                toggleButton.BackgroundColor3 = Color3.new(0.2, 0.8, 0.2)
                player.CharacterAdded:Connect(function(character)
                    character:WaitForChild("Humanoid")
                end)
            else
                toggleButton.Text = "关闭"
                toggleButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
            end
        end)
        
        return jumpFrame
    end
    
    -- ESP高亮功能
    local function setupESP()
        local espFrame = Instance.new("Frame")
        espFrame.Size = UDim2.new(1, 0, 1, 0)
        espFrame.BackgroundTransparency = 1
        espFrame.Visible = false
        espFrame.Parent = rightNav
        
        local title = Instance.new("TextLabel")
        title.Text = "高亮显示人物"
        title.Size = UDim2.new(1, 0, 0.1, 0)
        title.BackgroundTransparency = 1
        title.TextColor3 = Color3.new(1, 1, 1)
        title.TextScaled = true
        title.Font = Enum.Font.GothamBold
        title.Parent = espFrame
        
        local toggleButton = Instance.new("TextButton")
        toggleButton.Text = "关闭"
        toggleButton.Size = UDim2.new(0.3, 0, 0.1, 0)
        toggleButton.Position = UDim2.new(0.35, 0, 0.2, 0)
        toggleButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
        toggleButton.TextColor3 = Color3.new(1, 1, 1)
        toggleButton.Font = Enum.Font.Gotham
        toggleButton.TextScaled = true
        toggleButton.Parent = espFrame
        
        local function highlightPlayer(otherPlayer)
            if otherPlayer ~= player and otherPlayer.Character then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = Color3.new(1, 0, 0)
                highlight.OutlineColor = Color3.new(1, 1, 0)
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlight.Parent = otherPlayer.Character
                espHighlights[otherPlayer] = highlight
            end
        end
        
        local function removeHighlight(otherPlayer)
            if espHighlights[otherPlayer] then
                espHighlights[otherPlayer]:Destroy()
                espHighlights[otherPlayer] = nil
            end
        end
        
        toggleButton.MouseButton1Click:Connect(function()
            espEnabled = not espEnabled
            if espEnabled then
                toggleButton.Text = "开启"
                toggleButton.BackgroundColor3 = Color3.new(0.2, 0.8, 0.2)
                -- 高亮现有玩家
                for _, otherPlayer in ipairs(Players:GetPlayers()) do
                    highlightPlayer(otherPlayer)
                end
                -- 监听新玩家
                Players.PlayerAdded:Connect(highlightPlayer)
                Players.PlayerRemoving:Connect(removeHighlight)
            else
                toggleButton.Text = "关闭"
                toggleButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
                -- 移除所有高亮
                for otherPlayer, highlight in pairs(espHighlights) do
                    highlight:Destroy()
                end
                espHighlights = {}
            end
        end)
        
        return espFrame
    end
    
    -- 自动挥刀功能
    local function setupAutoSwing()
        local swingFrame = Instance.new("Frame")
        swingFrame.Size = UDim2.new(1, 0, 1, 0)
        swingFrame.BackgroundTransparency = 1
        swingFrame.Visible = false
        swingFrame.Parent = rightNav
        
        local title = Instance.new("TextLabel")
        title.Text = "自动挥刀"
        title.Size = UDim2.new(1, 0, 0.1, 0)
        title.BackgroundTransparency = 1
        title.TextColor3 = Color3.new(1, 1, 1)
        title.TextScaled = true
        title.Font = Enum.Font.GothamBold
        title.Parent = swingFrame
        
        local toggleButton = Instance.new("TextButton")
        toggleButton.Text = "关闭"
        toggleButton.Size = UDim2.new(0.3, 0, 0.1, 0)
        toggleButton.Position = UDim2.new(0.35, 0, 0.2, 0)
        toggleButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
        toggleButton.TextColor3 = Color3.new(1, 1, 1)
        toggleButton.Font = Enum.Font.Gotham
        toggleButton.TextScaled = true
        toggleButton.Parent = swingFrame
        
        local swingCoroutine = nil
        
        local function startSwinging()
            swingCoroutine = coroutine.create(function()
                while autoSwingEnabled do
                    local args = {"swingKatana"}
                    local ninjaEvent = player:WaitForChild("ninjaEvent")
                    ninjaEvent:FireServer(unpack(args))
                    wait(0.5)
                end
            end)
            coroutine.resume(swingCoroutine)
        end
        
        toggleButton.MouseButton1Click:Connect(function()
            autoSwingEnabled = not autoSwingEnabled
            if autoSwingEnabled then
                toggleButton.Text = "开启"
                toggleButton.BackgroundColor3 = Color3.new(0.2, 0.8, 0.2)
                startSwinging()
            else
                toggleButton.Text = "关闭"
                toggleButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
                if swingCoroutine then
                    coroutine.close(swingCoroutine)
                end
            end
        end)
        
        return swingFrame
    end
    
    -- 创建功能界面
    local jumpFrame = setupInfiniteJump()
    local espFrame = setupESP()
    local swingFrame = setupAutoSwing()
    
    -- 类型切换功能
    local function showFrame(frameToShow)
        jumpFrame.Visible = false
        espFrame.Visible = false
        swingFrame.Visible = false
        frameToShow.Visible = true
    end
    
    generalButton.MouseButton1Click:Connect(function() showFrame(jumpFrame) end)
    espButton.MouseButton1Click:Connect(function() showFrame(espFrame) end)
    ninjaButton.MouseButton1Click:Connect(function() showFrame(swingFrame) end)
    
    -- 默认显示通用功能
    showFrame(jumpFrame)
    
    -- 缩小功能
    local minimized = false
    local minimizedButton = nil
    
    local function minimizeInterface()
        minimized = true
        mainFrame.Visible = false
        
        -- 创建缩小后的按钮
        minimizedButton = Instance.new("Frame")
        minimizedButton.Size = UDim2.new(0.15, 0, 0.05, 0)
        minimizedButton.Position = UDim2.new(0.4, 0, 0.02, 0)
        minimizedButton.BackgroundColor3 = Color3.new(0.1, 0.1, 0.3)
        minimizedButton.BorderSizePixel = 0
        minimizedButton.Parent = screenGui
        
        local dragArea = Instance.new("TextButton")
        dragArea.Text = "≡"
        dragArea.Size = UDim2.new(0.2, 0, 1, 0)
        dragArea.BackgroundColor3 = Color3.new(0.2, 0.2, 0.4)
        dragArea.TextColor3 = Color3.new(1, 1, 1)
        dragArea.Font = Enum.Font.GothamBold
        dragArea.TextScaled = true
        dragArea.Parent = minimizedButton
        
        local expandArea = Instance.new("TextButton")
        expandArea.Text = "NZ"
        expandArea.Size = UDim2.new(0.8, 0, 1, 0)
        expandArea.Position = UDim2.new(0.2, 0, 0, 0)
        expandArea.BackgroundColor3 = Color3.new(0.1, 0.1, 0.3)
        expandArea.TextColor3 = Color3.new(1, 1, 1)
        expandArea.Font = Enum.Font.GothamBold
        expandArea.TextScaled = true
        expandArea.Parent = minimizedButton
        
        -- 拖动功能
        local dragging = false
        local dragInput, dragStart, startPos
        
        local function update(input)
            local delta = input.Position - dragStart
            minimizedButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, 
                                               startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
        
        dragArea.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = minimizedButton.Position
                
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end)
        
        dragArea.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement then
                dragInput = input
            end
        end)
        
        UserInputService.InputChanged:Connect(function(input)
            if input == dragInput and dragging then
                update(input)
            end
        end)
        
        -- 展开功能
        expandArea.MouseButton1Click:Connect(function()
            minimizedButton:Destroy()
            mainFrame.Visible = true
            minimized = false
        end)
    end
    
    minimizeButton.MouseButton1Click:Connect(minimizeInterface)
    closeButton.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)
end

-- 启动欢迎界面
createWelcomeScreen()

-- 将界面添加到玩家GUI
screenGui.Parent = playerGui


-- NZ黑洞助手主脚本
-- 版本 1.0

-- === 初始化 ===
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- 创建主GUI容器
local mainGui = Instance.new("ScreenGui")
mainGui.Name = "NZHeiDongAssistant"
mainGui.ResetOnSpawn = false
mainGui.Parent = playerGui

-- === 服务器ID检测 ===
local function checkServerId()
    -- 创建加载提示
    local loadingFrame = Instance.new("Frame")
    loadingFrame.Size = UDim2.new(0, 200, 0, 50)
    loadingFrame.Position = UDim2.new(0.8, 0, 0.1, 0)
    loadingFrame.BackgroundTransparency = 0.7
    loadingFrame.BackgroundColor3 = Color3.new(0, 0, 0)
    loadingFrame.BorderSizePixel = 0
    loadingFrame.Parent = mainGui
    
    local loadingText = Instance.new("TextLabel")
    loadingText.Size = UDim2.new(1, 0, 1, 0)
    loadingText.BackgroundTransparency = 1
    loadingText.TextColor3 = Color3.new(1, 1, 1)
    loadingText.Text = "正在加载中..."
    loadingText.Font = Enum.Font.SourceSansBold
    loadingText.TextSize = 18
    loadingText.Parent = loadingFrame
    
    -- 检测服务器ID
    local serverId = game.JobId
    wait(1) -- 模拟加载过程
    
    if string.find(serverId, "自然灾害") then
        loadingFrame:Destroy()
        showWelcomeMessage()
    else
        loadingText.Text = "此游戏不受支持"
        wait(3)
        loadingFrame:Destroy()
    end
end

-- === 欢迎消息 ===
local function showWelcomeMessage()
    local welcomeFrame = Instance.new("Frame")
    welcomeFrame.Size = UDim2.new(0, 300, 0, 150)
    welcomeFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
    welcomeFrame.BackgroundTransparency = 0.3
    welcomeFrame.BackgroundColor3 = Color3.new(0, 0, 0)
    welcomeFrame.BorderSizePixel = 0
    welcomeFrame.Parent = mainGui
    
    -- 主标题
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 40)
    title.Position = UDim2.new(0, 0, 0, 10)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Text = "NZ黑洞助手"
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 28
    title.TextXAlignment = Enum.TextXAlignment.Center
    title.Parent = welcomeFrame
    
    -- 副标题
    local subtitle = Instance.new("TextLabel")
    subtitle.Size = UDim2.new(1, 0, 0, 30)
    subtitle.Position = UDim2.new(0, 0, 0, 50)
    subtitle.BackgroundTransparency = 1
    subtitle.TextColor3 = Color3.new(0.8, 0.8, 0.8)
    subtitle.Text = "你好，欢迎您使用NZ黑洞助手，祝您愉快！"
    subtitle.Font = Enum.Font.SourceSans
    subtitle.TextSize = 14
    subtitle.TextXAlignment = Enum.TextXAlignment.Center
    subtitle.Parent = welcomeFrame
    
    -- 关闭提示
    local closeText = Instance.new("TextLabel")
    closeText.Size = UDim2.new(1, 0, 0, 20)
    closeText.Position = UDim2.new(0, 0, 0, 90)
    closeText.BackgroundTransparency = 1
    closeText.TextColor3 = Color3.new(0.6, 0.6, 0.6)
    closeText.Text = "点击任意地方关闭提示"
    closeText.Font = Enum.Font.SourceSans
    closeText.TextSize = 12
    closeText.TextXAlignment = Enum.TextXAlignment.Center
    closeText.Parent = welcomeFrame
    
    -- 点击关闭
    local function closeWelcome()
        welcomeFrame:Destroy()
        createMainPanel()
    end
    
    -- 添加点击检测
    local clickDetector = Instance.new("TextButton")
    clickDetector.Size = UDim2.new(1, 0, 1, 0)
    clickDetector.BackgroundTransparency = 1
    clickDetector.Text = ""
    clickDetector.Parent = welcomeFrame
    
    clickDetector.MouseButton1Click:Connect(closeWelcome)
end

-- === 主面板 ===
local mainPanel = nil
local isPanelMinimized = false

local function createMainPanel()
    mainPanel = Instance.new("Frame")
    mainPanel.Size = UDim2.new(0, 250, 0, 200)
    mainPanel.Position = UDim2.new(0.1, 0, 0.3, 0)
    mainPanel.BackgroundTransparency = 0.2
    mainPanel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainPanel.BorderSizePixel = 0
    mainPanel.Parent = mainGui
    
    -- 标题
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.BackgroundTransparency = 0.3
    title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Text = "NZ黑洞助手 v1.0"
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 16
    title.TextXAlignment = Enum.TextXAlignment.Center
    title.Parent = mainPanel
    
    -- 攻击黑洞功能
    local attackBlackholeFrame = Instance.new("Frame")
    attackBlackholeFrame.Size = UDim2.new(1, 0, 0, 40)
    attackBlackholeFrame.Position = UDim2.new(0, 0, 0, 40)
    attackBlackholeFrame.BackgroundTransparency = 0.3
    attackBlackholeFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    attackBlackholeFrame.Parent = mainPanel
    
    local attackLabel = Instance.new("TextLabel")
    attackLabel.Size = UDim2.new(0.7, 0, 1, 0)
    attackLabel.Position = UDim2.new(0, 10, 0, 0)
    attackLabel.BackgroundTransparency = 1
    attackLabel.TextColor3 = Color3.new(1, 1, 1)
    attackLabel.Text = "攻击黑洞"
    attackLabel.Font = Enum.Font.SourceSans
    attackLabel.TextSize = 16
    attackLabel.TextXAlignment = Enum.TextXAlignment.Left
    attackLabel.Parent = attackBlackholeFrame
    
    local attackToggle = Instance.new("TextButton")
    attackToggle.Size = UDim2.new(0, 50, 0, 25)
    attackToggle.Position = UDim2.new(0.75, 0, 0.5, -12)
    attackToggle.BackgroundTransparency = 0.3
    attackToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    attackToggle.Text = "关闭"
    attackToggle.Font = Enum.Font.SourceSansBold
    attackToggle.TextColor3 = Color3.new(1, 1, 1)
    attackToggle.TextSize = 14
    attackToggle.Parent = attackBlackholeFrame
    
    -- 地爆天星功能
    local planetaryExplosionFrame = Instance.new("Frame")
    planExplosionFrame.Size = UDim2.new(1, 0, 0, 40)
    planExplosionFrame.Position = UDim2.new(0, 0, 0, 90)
    planExplosionFrame.BackgroundTransparency = 0.3
    planExplosionFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    planExplosionFrame.Parent = mainPanel
    
    local planLabel = Instance.new("TextLabel")
    planLabel.Size = UDim2.new(0.7, 0, 1, 0)
    planLabel.Position = UDim2.new(0, 10, 0, 0)
    planLabel.BackgroundTransparency = 1
    planLabel.TextColor3 = Color3.new(1, 1, 1)
    planLabel.Text = "地爆天星"
    planLabel.Font = Enum.Font.SourceSans
    planLabel.TextSize = 16
    planLabel.TextXAlignment = Enum.TextXAlignment.Left
    planLabel.Parent = planExplosionFrame
    
    local planToggle = Instance.new("TextButton")
    planToggle.Size = UDim2.new(0, 50, 0, 25)
    planToggle.Position = UDim2.new(0.75, 0, 0.5, -12)
    planToggle.BackgroundTransparency = 0.3
    planToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    planToggle.Text = "关闭"
    planToggle.Font = Enum.Font.SourceSansBold
    planToggle.TextColor3 = Color3.new(1, 1, 1)
    planToggle.TextSize = 14
    planToggle.Parent = planExplosionFrame
    
    -- 关闭面板按钮
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Size = UDim2.new(1, 0, 0, 30)
    minimizeBtn.Position = UDim2.new(0, 0, 1, -30)
    minimizeBtn.BackgroundTransparency = 0.3
    minimizeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    minimizeBtn.Text = "最小化面板"
    minimizeBtn.Font = Enum.Font.SourceSansBold
    minimizeBtn.TextColor3 = Color3.new(1, 1, 1)
    minimizeBtn.TextSize = 14
    minimizeBtn.Parent = mainPanel
    
    -- 功能状态变量
    local isAttackActive = false
    local isPlanActive = false
    local debrisGroup = {}
    local planetaryBall = nil
    local ballPart = nil
    
    -- 攻击黑洞功能
    local function toggleAttackBlackhole()
        isAttackActive = not isAttackActive
        attackToggle.Text = isAttackActive and "开启" or "关闭"
        attackToggle.BackgroundColor3 = isAttackActive and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(200, 0, 0)
        
        if isAttackActive then
            spawn(function()
                while isAttackActive and wait(0.1) do
                    -- 检测未固定零件
                    local parts = workspace:GetDescendants()
                    for _, part in ipairs(parts) do
                        if part:IsA("BasePart") and not part.Anchored and part.CanCollide then
                            -- 吸到天上
                            local targetPos = part.Position + Vector3.new(0, 50, 0)
                            part.Velocity = (targetPos - part.Position).unit * 50
                            
                            -- 检测玩家并甩飞
                            for _, otherPlayer in ipairs(Players:GetPlayers()) do
                                if otherPlayer ~= player and otherPlayer.Character then
                                    local humanoidRootPart = otherPlayer.Character:FindFirstChild("HumanoidRootPart")
                                    if humanoidRootPart then
                                        local distance = (part.Position - humanoidRootPart.Position).magnitude
                                        if distance < 30 then
                                            -- 高速旋转飞向玩家
                                            local direction = (humanoidRootPart.Position - part.Position).unit
                                            part.Velocity = direction * 100
                                            
                                            -- 甩飞玩家
                                            local humanoid = otherPlayer.Character:FindFirstChild("Humanoid")
                                            if humanoid then
                                                humanoid:ApplyImpulse(direction * 50)
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end)
        end
    end
    
    -- 地爆天星功能
    local function togglePlanetaryExplosion()
        isPlanActive = not isPlanActive
        planToggle.Text = isPlanActive and "开启" or "关闭"
        planToggle.BackgroundColor3 = isPlanActive and Color3.fromRGB(0, 200, 200) or Color3.fromRGB(200, 0, 0)
        
        if isPlanActive then
            -- 创建汇聚球体
            if not ballPart then
                ballPart = Instance.new("Part")
                ballPart.Name = "PlanetaryBall"
                ballPart.Size = Vector3.new(5, 5, 5)
                ballPart.Position = workspace.CurrentCamera.CFrame.Position + Vector3.new(0, 10, 0)
                ballPart.Anchored = true
                ballPart.CanCollide = false
                ballPart.Transparency = 0.5
                ballPart.Color = Color3.fromRGB(255, 100, 100)
                ballPart.Parent = workspace
                
                local specialMesh = Instance.new("SpecialMesh")
                specialMesh.MeshType = Enum.MeshType.Sphere
                specialMesh.Scale = Vector3.new(3, 3, 3)
                specialMesh.Parent = ballPart
            end
            
            -- 吸收零件
            spawn(function()
                while isPlanActive and wait(0.1) do
                    local parts = workspace:GetDescendants()
                    for _, part in ipairs(parts) do
                        if part:IsA("BasePart") and not part.Anchored and part.CanCollide then
                            if not table.find(debrisGroup, part) then
                                table.insert(debrisGroup, part)
                            end
                            
                            -- 吸向球体
                            if ballPart then
                                local direction = (ballPart.Position - part.Position).unit
                                part.Velocity = direction * 30
                            end
                        end
                    end
                end
            end)
            
            -- 点击事件
            local mouse = player:GetMouse()
            local mouseClickConn
            mouseClickConn = mouse.Button1Down:Connect(function()
                if isPlanActive and ballPart then
                    local ray = Ray.new(mouse.Hit.Position, Vector3.new(0, -1, 0))
                    local part, position = workspace:FindPartOnRay(ray)
                    
                    if position then
                        -- 球体飞向点击位置
                        ballPart.Anchored = false
                        ballPart.Velocity = (position - ballPart.Position).unit * 100
                        
                        -- 撞飞玩家
                        spawn(function()
                            wait(0.5)
                            for _, otherPlayer in ipairs(Players:GetPlayers()) do
                                if otherPlayer ~= player and otherPlayer.Character then
                                    local humanoidRootPart = otherPlayer.Character:FindFirstChild("HumanoidRootPart")
                                    if humanoidRootPart then
                                        local distance = (ballPart.Position - humanoidRootPart.Position).magnitude
                                        if distance < 20 then
                                            local humanoid = otherPlayer.Character:FindFirstChild("Humanoid")
                                            if humanoid then
                                                humanoid:ApplyImpulse((humanoidRootPart.Position - ballPart.Position).unit * 100)
                                            end
                                        end
                                    end
                                end
                            end
                        end)
                    end
                end
            end)
            
            -- 清理连接
            spawn(function()
                while isPlanActive do
                    wait(0.1)
                end
                if mouseClickConn then
                    mouseClickConn:Disconnect()
                end
            end)
        else
            -- 清理
            if ballPart then
                ballPart:Destroy()
                ballPart = nil
            end
            debrisGroup = {}
        end
    end
    
    -- 按钮事件
    attackToggle.MouseButton1Click:Connect(toggleAttackBlackhole)
    planToggle.MouseButton1Click:Connect(togglePlanetaryExplosion)
    
    -- 最小化/恢复面板
    minimizeBtn.MouseButton1Click:Connect(function()
        isPanelMinimized = not isPanelMinimized
        minimizeBtn.Text = isPanelMinimized and "恢复面板" or "最小化面板"
        
        if isPanelMinimized then
            mainPanel.Size = UDim2.new(0, 100, 0, 30)
            title.Text = "NZ助手"
        else
            mainPanel.Size = UDim2.new(0, 250, 0, 200)
            title.Text = "NZ黑洞助手 v1.0"
        end
    end)
    
    -- 拖拽功能
    local dragging = false
    local dragStartPos
    local frameStartPos
    
    mainPanel.MouseEnter:Connect(function()
        mainPanel.Active = true
    end)
    
    mainPanel.MouseLeave:Connect(function()
        mainPanel.Active = false
    end)
    
    mainPanel.MouseButton1Down:Connect(function()
        dragging = true
        dragStartPos = Vector2.new(mouse.X, mouse.Y)
        frameStartPos = mainPanel.Position
    end)
    
    mainPanel.MouseButton1Up:Connect(function()
        dragging = false
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
            local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
            mainPanel.Position = UDim2.new(
                frameStartPos.X.Scale, 
                frameStartPos.X.Offset + delta.X,
                frameStartPos.Y.Scale,
                frameStartPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- === 启动脚本 ===
checkServerId()

-- NZ黑洞助手 - 手机端完整版（带欢迎动画）
-- 版本 2.1

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local gui = Instance.new("ScreenGui")
gui.Name = "NZHeiDongAssistant"
gui.ResetOnSpawn = false
gui.Parent = playerGui

local TweenService = game:GetService("TweenService")

-- =============== 欢迎页面（带动画） ===============
local function showWelcome()
    -- 背景半透明遮罩
    local overlay = Instance.new("Frame")
    overlay.Size = UDim2.new(1, 0, 1, 0)
    overlay.BackgroundTransparency = 0.5
    overlay.BackgroundColor3 = Color3.new(0, 0, 0)
    overlay.BorderSizePixel = 0
    overlay.Visible = false
    overlay.Parent = gui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 280, 0, 180)
    frame.Position = UDim2.new(0.5, -140, 1, 50) -- 初始在屏幕下方
    frame.BackgroundTransparency = 0.2
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    frame.BorderSizePixel = 0
    frame.Parent = gui
    frame.Visible = false

    local image = Instance.new("ImageLabel")
    image.Size = UDim2.new(0, 50, 0, 50)
    image.Position = UDim2.new(0.5, -25, -0.1, 0)
    image.Image = "http://www.roblox.com/asset/?id=105529853851343"
    image.BackgroundTransparency = 1
    image.ImageTransparency = 1
    image.Parent = frame

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 25)
    title.Position = UDim2.new(0, 0, 0, 70)
    title.BackgroundTransparency = 1
    title.Text = "NZ黑洞助手"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 20
    title.TextXAlignment = Enum.TextXAlignment.Center
    title.TextTransparency = 1
    title.Parent = frame

    local subtitle = Instance.new("TextLabel")
    subtitle.Size = UDim2.new(1, 0, 0, 18)
    subtitle.Position = UDim2.new(0, 0, 0, 100)
    subtitle.BackgroundTransparency = 1
    subtitle.Text = "你好，欢迎您使用NZ黑洞助手，祝您愉快！"
    subtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
    subtitle.Font = Enum.Font.SourceSans
    subtitle.TextSize = 12
    subtitle.TextXAlignment = Enum.TextXAlignment.Center
    subtitle.TextTransparency = 1
    subtitle.Parent = frame

    local closeTip = Instance.new("TextLabel")
    closeTip.Size = UDim2.new(1, 0, 0, 18)
    closeTip.Position = UDim2.new(0, 0, 0, 130)
    closeTip.BackgroundTransparency = 1
    closeTip.Text = "点击任意地方关闭提示"
    closeTip.TextColor3 = Color3.fromRGB(150, 150, 150)
    closeTip.Font = Enum.Font.SourceSans
    closeTip.TextSize = 10
    closeTip.TextXAlignment = Enum.TextXAlignment.Center
    closeTip.TextTransparency = 1
    closeTip.Parent = frame

    -- 动画显示
    overlay.Visible = true
    frame.Visible = true

    -- 滑入 + 淡入动画
    TweenService:Create(frame, TweenInfo.new(0.4), {Position = UDim2.new(0.5, -140, 0.4, -90)}):Play()
    TweenService:Create(image, TweenInfo.new(0.5), {Position = UDim2.new(0.5, -25, 0.1, 0), ImageTransparency = 0}):Play()
    TweenService:Create(title, TweenInfo.new(0.6), {TextTransparency = 0}):Play()
    TweenService:Create(subtitle, TweenInfo.new(0.7), {TextTransparency = 0}):Play()
    TweenService:Create(closeTip, TweenInfo.new(0.8), {TextTransparency = 0}):Play()

    -- 点击关闭
    local clickDetector = Instance.new("TextButton")
    clickDetector.Size = UDim2.new(1, 0, 1, 0)
    clickDetector.BackgroundTransparency = 1
    clickDetector.Text = ""
    clickDetector.Parent = frame
    clickDetector.MouseButton1Click:Connect(function()
        -- 反向动画后关闭
        TweenService:Create(frame, TweenInfo.new(0.4), {Position = UDim2.new(0.5, -140, 1, 50)}):Play()
        TweenService:Create(image, TweenInfo.new(0.3), {ImageTransparency = 1}):Play()
        TweenService:Create(title, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
        TweenService:Create(subtitle, TweenInfo.new(0.3), {TextTransparency = 1}):Play()
        TweenService:Create(closeTip, TweenInfo.new(0.3), {TextTransparency = 1}):Play()
        TweenService:Create(overlay, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
        wait(0.5)
        overlay:Destroy()
        frame:Destroy()
        createMainPanel()
    end)
end

-- =============== 主功能面板 ===============
local function createMainPanel()
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 300, 0, 400)
    mainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = gui
    mainFrame.Draggable = true

    -- 左侧导航栏
    local navFrame = Instance.new("Frame")
    navFrame.Size = UDim2.new(0, 90, 1, 0)
    navFrame.BackgroundTransparency = 0.2
    navFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    navFrame.BorderSizePixel = 0
    navFrame.Parent = mainFrame

    local通用Btn = Instance.new("TextButton")
   通用Btn.Size = UDim2.new(1, 0, 0, 40)
   通用Btn.Position = UDim2.new(0, 0, 0, 0)
   通用Btn.BackgroundTransparency = 0.3
   通用Btn.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
   通用Btn.Text = "通用"
   通用Btn.TextColor3 = Color3.fromRGB(220, 220, 220)
   通用Btn.Font = Enum.Font.SourceSans
   通用Btn.TextSize = 14
   通用Btn.Parent = navFrame

    local disasterBtn = Instance.new("TextButton")
    disasterBtn.Size = UDim2.new(1, 0, 0, 40)
    disasterBtn.Position = UDim2.new(0, 0, 0, 50)
    disasterBtn.BackgroundTransparency = 0.3
    disasterBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    disasterBtn.Text = "自然灾害"
    disasterBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
    disasterBtn.Font = Enum.Font.SourceSans
    disasterBtn.TextSize = 14
    disasterBtn.Parent = navFrame

    -- 右侧功能区
    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, -90, 1, 0)
    contentFrame.Position = UDim2.new(0, 90, 0, 0)
    contentFrame.BackgroundTransparency = 0.1
    contentFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
    contentFrame.BorderSizePixel = 0
    contentFrame.Parent = mainFrame

    -- 功能：透视
    local outlineBtn = createToggleFunction(contentFrame, "透视", "关闭", Vector2.new(0, 0))
    local outlineActive = false
    outlineBtn.Toggle.MouseButton1Click:Connect(function()
        outlineActive = not outlineActive
        outlineBtn.Toggle.Text = outlineActive and "开启" or "关闭"
        outlineBtn.Toggle.BackgroundColor3 = outlineActive and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(100, 100, 120)
        
        if outlineActive then
            for _, p in ipairs(Players:GetPlayers()) do
                if p ~= player and p.Character then
                    for _, part in ipairs(p.Character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            local outline = Instance.new("SelectionBox")
                            outline.Adornee = part
                            outline.Color = Color3.fromRGB(255, 0, 0)
                            outline.Parent = part
                        end
                    end
                end
            end
        else
            for _, p in ipairs(Players:GetPlayers()) do
                if p ~= player and p.Character then
                    for _, part in ipairs(p.Character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            local outline = part:FindFirstChild("SelectionBox")
                            if outline then outline:Destroy() end
                        end
                    end
                end
            end
        end
    end)

    -- 功能：无限跳
    local infiniteJumpBtn = createToggleFunction(contentFrame, "无限跳", "关闭", Vector2.new(0, 50))
    local infiniteJumpActive = false
    infiniteJumpBtn.Toggle.MouseButton1Click:Connect(function()
        infiniteJumpActive = not infiniteJumpActive
        infiniteJumpBtn.Toggle.Text = infiniteJumpActive and "开启" or "关闭"
        infiniteJumpBtn.Toggle.BackgroundColor3 = infiniteJumpActive and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(100, 100, 120)
    end)

    -- 功能：地爆天星
    local planetBtn = createToggleFunction(contentFrame, "地爆天星", "关闭", Vector2.new(0, 100))
    local planetActive = false
    local planetaryBall = nil
    planetBtn.Toggle.MouseButton1Click:Connect(function()
        planetActive = not planetActive
        planetBtn.Toggle.Text = planetActive and "开启" or "关闭"
        planetBtn.Toggle.BackgroundColor3 = planetActive and Color3.fromRGB(0, 200, 200) or Color3.fromRGB(100, 100, 120)

        if planetActive then
            local mouse = player:GetMouse()
            local function onTouch(input, processed)
                if processed or input.UserInputType ~= Enum.UserInputType.Touch then return end
                local ray = workspace:ScreenPointToRay(input.Position.X, input.Position.Y)
                local part, pos = workspace:FindPartOnRay(ray)
                if pos then
                    if not planetaryBall then
                        planetaryBall = Instance.new("Part")
                        planetaryBall.Size = Vector3.new(6,6,6)
                        planetaryBall.Anchored = true
                        planetaryBall.CanCollide = false
                        planetaryBall.Transparency = 0.4
                        planetaryBall.Parent = workspace
                        local mesh = Instance.new("SpecialMesh")
                        mesh.MeshType = Enum.MeshType.Sphere
                        mesh.Scale = Vector3.new(3,3,3)
                        mesh.Parent = planetaryBall
                    end
                    planetaryBall.Position = pos + Vector3.new(0,3,0)
                end
            end

            local function onRelease(input, processed)
                if processed or input.UserInputType ~= Enum.UserInputType.Touch then return end
                if planetaryBall then
                    -- 爆炸逻辑
                    for _, p in ipairs(workspace:GetDescendants()) do
                        if p:IsA("BasePart") and not p.Anchored and p ~= planetaryBall then
                            local dir = (p.Position - planetaryBall.Position).unit
                            p:ApplyImpulse(dir * 150)
                        end
                    end
                    planetaryBall:Destroy()
                    planetaryBall = nil
                    planetActive = false
                    planetBtn.Toggle.Text = "关闭"
                    planetBtn.Toggle.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
                end
            end

            local connTouch = game:GetService("UserInputService").InputBegan:Connect(onTouch)
            local connRelease = game:GetService("UserInputService").InputEnded:Connect(onRelease)

            -- 清理连接
            spawn(function()
                while planetActive do wait() end
                connTouch:Disconnect()
                connRelease:Disconnect()
            end)
        else
            if planetaryBall then
                planetaryBall:Destroy()
                planetaryBall = nil
            end
        end
    end)

    -- 功能：攻击黑洞
    local attackBtn = createToggleFunction(contentFrame, "攻击黑洞", "关闭", Vector2.new(0, 150))
    local attackActive = false
    attackBtn.Toggle.MouseButton1Click:Connect(function()
        attackActive = not attackActive
        attackBtn.Toggle.Text = attackActive and "开启" or "关闭"
        attackBtn.Toggle.BackgroundColor3 = attackActive and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(100, 100, 120)

        if attackActive then
            spawn(function()
                while attackActive and wait(0.1) do
                    for _, part in ipairs(workspace:GetDescendants()) do
                        if part:IsA("BasePart") and not part.Anchored then
                            local target = part.Position + Vector3.new(0,50,0)
                            part.Velocity = (target - part.Position).unit * 40
                            -- 甩飞玩家
                            for _, p in ipairs(Players:GetPlayers()) do
                                if p ~= player and p.Character then
                                    local root = p.Character:FindFirstChild("HumanoidRootPart")
                                    if root and (part.Position - root.Position).magnitude < 25 then
                                        part.Velocity = (root.Position - part.Position).unit * 80
                                        local hum = p.Character:FindFirstChild("Humanoid")
                                        if hum then hum:ApplyImpulse((root.Position - part.Position).unit * 40) end
                                    end
                                end
                            end
                        end
                    end
                end
            end)
        end
    end)

    -- 默认显示通用功能
    local function showCategory(category)
        outlineBtn.Frame.Visible = (category == "通用")
        infiniteJumpBtn.Frame.Visible = (category == "通用")
        planetBtn.Frame.Visible = (category == "自然灾害")
        attackBtn.Frame.Visible = (category == "自然灾害")
    end
    showCategory("通用")

    -- 导航切换
   通用Btn.MouseButton1Click:Connect(function() showCategory("通用") end)
    disasterBtn.MouseButton1Click:Connect(function() showCategory("自然灾害") end)

    -- 拖拽支持
    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            mainFrame.Draggable = true
        end
    end)
    mainFrame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            mainFrame.Draggable = false
        end
    end)
end

-- =============== 创建功能项 ===============
local function createToggleFunction(parent, name, defaultState, pos)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 40)
    frame.Position = UDim2.new(0, pos.X, 0, pos.Y)
    frame.BackgroundTransparency = 0.3
    frame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    frame.BorderSizePixel = 0
    frame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.6, 0, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.Font = Enum.Font.SourceSans
    label.TextSize = 14
    label.Parent = frame

    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(0, 50, 0, 22)
    toggle.Position = UDim2.new(0.7, 0, 0.5, -11)
    toggle.BackgroundTransparency = 0.4
    toggle.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
    toggle.Text = defaultState
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.Font = Enum.Font.SourceSansBold
    toggle.TextSize = 12
    toggle.Parent = frame

    return { Frame = frame, Toggle = toggle }
end

-- =============== 无限跳逻辑 ===============
game:GetService("UserInputService").InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.UserInputType == Enum.UserInputType.Touch and player.Character then
        local humanoid = player.Character:FindFirstChild("Humanoid")
        if humanoid and humanoid:GetState() == Enum.HumanoidStateType.Freefall then
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

-- =============== 启动 ===============
showWelcome()

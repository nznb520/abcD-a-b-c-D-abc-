-- NZ黑洞助手 - 手机端适配版
-- 版本 1.0

-- 服务引用
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local gui = Instance.new("ScreenGui")
gui.Name = "NZHeiDongAssistant"
gui.ResetOnSpawn = false
gui.Parent = playerGui

-- 欢迎界面
local function showWelcome()
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 280, 0, 180) -- 调整为适合手机屏幕的大小
    frame.Position = UDim2.new(0.5, -140, 0.4, -90)
    frame.BackgroundTransparency = 0.2
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    frame.BorderSizePixel = 0
    frame.Parent = gui

    -- 贴花图片
    local image = Instance.new("ImageLabel")
    image.Size = UDim2.new(0, 50, 0, 50)
    image.Position = UDim2.new(0.5, -25, 0.1, 0)
    image.Image = "http://www.roblox.com/asset/?id=105529853851343"
    image.BackgroundTransparency = 1
    image.Parent = frame

    -- 主标题
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 25)
    title.Position = UDim2.new(0, 0, 0, 70)
    title.BackgroundTransparency = 1
    title.Text = "NZ黑洞助手"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 20
    title.TextXAlignment = Enum.TextXAlignment.Center
    title.Parent = frame

    -- 副标题
    local subtitle = Instance.new("TextLabel")
    subtitle.Size = UDim2.new(1, 0, 0, 18)
    subtitle.Position = UDim2.new(0, 0, 0, 100)
    subtitle.BackgroundTransparency = 1
    subtitle.Text = "你好，欢迎您使用NZ黑洞助手，祝您愉快！"
    subtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
    subtitle.Font = Enum.Font.SourceSans
    subtitle.TextSize = 12
    subtitle.TextXAlignment = Enum.TextXAlignment.Center
    subtitle.Parent = frame

    -- 关闭提示
    local closeTip = Instance.new("TextLabel")
    closeTip.Size = UDim2.new(1, 0, 0, 18)
    closeTip.Position = UDim2.new(0, 0, 0, 130)
    closeTip.BackgroundTransparency = 1
    closeTip.Text = "点击任意地方关闭提示"
    closeTip.TextColor3 = Color3.fromRGB(150, 150, 150)
    closeTip.Font = Enum.Font.SourceSans
    closeTip.TextSize = 10
    closeTip.TextXAlignment = Enum.TextXAlignment.Center
    closeTip.Parent = frame

    -- 点击关闭
    local clickDetector = Instance.new("TextButton")
    clickDetector.Size = UDim2.new(1, 0, 1, 0)
    clickDetector.BackgroundTransparency = 1
    clickDetector.Text = ""
    clickDetector.Parent = frame
    clickDetector.MouseButton1Click:Connect(function()
        frame:Destroy()
        createMainPanel()
    end)
end

-- 主面板
local mainPanel = nil
local isMinimized = false

local function createMainPanel()
    -- 右上角用户信息标签
    local infoTag = Instance.new("TextLabel")
    infoTag.Size = UDim2.new(0, 200, 0, 35)
    infoTag.Position = UDim2.new(0.75, 0, 0.02, 0)
    infoTag.BackgroundTransparency = 0.3
    infoTag.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    infoTag.BorderSizePixel = 0
    infoTag.Text = string.format("<font color='#FF6EC7'>尊敬的 %s</font><br><font size='8' color='#AAAAAA'>感谢您使用NZ黑洞中心</font>", player.Name)
    infoTag.RichText = true
    infoTag.Font = Enum.Font.SourceSans
    infoTag.TextSize = 12
    infoTag.TextXAlignment = Enum.TextXAlignment.Left
    infoTag.Parent = gui

    -- 主控制面板
    mainPanel = Instance.new("Frame")
    mainPanel.Size = UDim2.new(0, 240, 0, 200)
    mainPanel.Position = UDim2.new(0.7, 0, 0.2, 0)
    mainPanel.BackgroundTransparency = 0.15
    mainPanel.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
    mainPanel.BorderSizePixel = 0
    mainPanel.Parent = gui

    -- 标题栏
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 35)
    titleBar.BackgroundTransparency = 0.2
    titleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    titleBar.Parent = mainPanel

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 1, 0)
    title.BackgroundTransparency = 1
    title.Text = "NZ 黑洞控制中心"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 16
    title.TextXAlignment = Enum.TextXAlignment.Center
    title.Parent = titleBar

    -- 功能1：攻击黑洞
    local attackFrame = Instance.new("Frame")
    attackFrame.Size = UDim2.new(1, 0, 0, 35)
    attackFrame.Position = UDim2.new(0, 0, 0, 45)
    attackFrame.BackgroundTransparency = 0.3
    attackFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    attackFrame.Parent = mainPanel

    local attackLabel = Instance.new("TextLabel")
    attackLabel.Size = UDim2.new(0.6, 0, 1, 0)
    attackLabel.Position = UDim2.new(0, 10, 0, 0)
    attackLabel.BackgroundTransparency = 1
    attackLabel.Text = "攻击黑洞"
    attackLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    attackLabel.Font = Enum.Font.SourceSans
    attackLabel.TextSize = 14
    attackLabel.Parent = attackFrame

    local attackToggle = Instance.new("TextButton")
    attackToggle.Size = UDim2.new(0, 50, 0, 22)
    attackToggle.Position = UDim2.new(0.7, 0, 0.5, -11)
    attackToggle.BackgroundTransparency = 0.4
    attackToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
    attackToggle.Text = "关闭"
    attackToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    attackToggle.Font = Enum.Font.SourceSansBold
    attackToggle.TextSize = 12
    attackToggle.Parent = attackFrame

    -- 功能2：地爆天星（优化版）
    local planetFrame = Instance.new("Frame")
    planetFrame.Size = UDim2.new(1, 0, 0, 35)
    planetFrame.Position = UDim2.new(0, 0, 0, 90)
    planetFrame.BackgroundTransparency = 0.3
    planetFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    planetFrame.Parent = mainPanel

    local planetLabel = Instance.new("TextLabel")
    planetLabel.Size = UDim2.new(0.6, 0, 1, 0)
    planetLabel.Position = UDim2.new(0, 10, 0, 0)
    planetLabel.BackgroundTransparency = 1
    planetLabel.Text = "地爆天星"
    planetLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    planetLabel.Font = Enum.Font.SourceSans
    planetLabel.TextSize = 14
    planetLabel.Parent = planetFrame

    local planetToggle = Instance.new("TextButton")
    planetToggle.Size = UDim2.new(0, 50, 0, 22)
    planetToggle.Position = UDim2.new(0.7, 0, 0.5, -11)
    planetToggle.BackgroundTransparency = 0.4
    planetToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
    planetToggle.Text = "关闭"
    planetToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    planetToggle.Font = Enum.Font.SourceSansBold
    planetToggle.TextSize = 12
    planetToggle.Parent = planetFrame

    -- 最小化按钮
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Size = UDim2.new(1, 0, 0, 25)
    minimizeBtn.Position = UDim2.new(0, 0, 1, -25)
    minimizeBtn.BackgroundTransparency = 0.4
    minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    minimizeBtn.Text = "最小化面板"
    minimizeBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
    minimizeBtn.Font = Enum.Font.SourceSans
    minimizeBtn.TextSize = 12
    minimizeBtn.Parent = mainPanel

    -- 地爆天星功能逻辑
    local planetaryBall = nil
    local isPlanActive = false

    local function createPlanetaryExplosionEffect(center)
        if not planetaryBall then
            planetaryBall = Instance.new("Part")
            planetaryBall.Name = "PlanetaryBall"
            planetaryBall.Size = Vector3.new(6, 6, 6)
            planetaryBall.Position = center
            planetaryBall.Anchored = true
            planetaryBall.CanCollide = false
            planetaryBall.Transparency = 0.4
            planetaryBall.Parent = workspace

            local mesh = Instance.new("SpecialMesh")
            mesh.MeshType = Enum.MeshType.Sphere
            mesh.Scale = Vector3.new(3, 3, 3)
            mesh.Parent = planetaryBall

            -- 添加粒子效果
            local particle = Instance.new("ParticleEmitter")
            particle.Parent = planetaryBall
            particle.Texture = "rbxassetid://3007300343"
            particle.Color = ColorSequence.new(Color3.fromRGB(255, 100, 100))
            particle.Lifetime = NumberRange.new(0.5, 1)
            particle.Rate = 80
            particle.Speed = NumberRange.new(2, 5)
            particle.ZOffset = 1
            particle:Emit(30)
        end
    end

    local function updatePlanetaryExplosion(touchPos)
        if planetaryBall then
            local ray = workspace:ScreenPointToRay(touchPos.X, touchPos.Y)
            local part, position = workspace:FindPartOnRay(ray)
            if position then
                planetaryBall.Position = position + Vector3.new(0, 3, 0)
            end
        end
    end

    local function explodeParts(center)
        for _, part in ipairs(workspace:GetDescendants()) do
            if part:IsA("BasePart") and not part.Anchored and part.Parent ~= planetaryBall then
                local direction = (part.Position - center).unit
                part:ApplyImpulse(direction * 150)
            end
        end

        -- 爆炸粒子效果
        local explosion = Instance.new("Part")
        explosion.Size = Vector3.new(1, 1, 1)
        explosion.Position = center
        explosion.Anchored = true
        explosion.CanCollide = false
        explosion.Parent = workspace

        local particle = Instance.new("ParticleEmitter")
        particle.Parent = explosion
        particle.Texture = "rbxassetid://111111111"
        particle.Lifetime = NumberRange.new(1)
        particle.Rate = 150
        particle.Speed = NumberRange.new(8, 15)
        particle:Emit(80)

        spawn(function()
            wait(2)
            explosion:Destroy()
        end)
    end

    -- 触摸事件处理
    local function onTouchStarted(touch, processed)
        if processed then return end
        if isPlanActive and planetaryBall then
            updatePlanetaryExplosion(touch.Position)
        end
    end

    -- 地爆天星开关逻辑
    planetToggle.MouseButton1Click:Connect(function()
        isPlanActive = not isPlanActive
        planetToggle.Text = isPlanActive and "开启" or "关闭"
        planetToggle.BackgroundColor3 = isPlanActive and Color3.fromRGB(0, 200, 200) or Color3.fromRGB(100, 100, 120)

        if isPlanActive then
            -- 监听触摸事件
            local touchConn = game:GetService("UserInputService").TouchStarted:Connect(onTouchStarted)

            -- 点击释放
            local clickConn
            clickConn = game:GetService("UserInputService").InputEnded:Connect(function(input, processed)
                if input.UserInputType == Enum.UserInputType.Touch and not processed then
                    if isPlanActive and planetaryBall then
                        explodeParts(planetaryBall.Position)
                        planetaryBall:Destroy()
                        planetaryBall = nil
                        isPlanActive = false
                        planetToggle.Text = "关闭"
                        planetToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
                        if touchConn then touchConn:Disconnect() end
                        if clickConn then clickConn:Disconnect() end
                    end
                end
            end)
        else
            if planetaryBall then
                planetaryBall:Destroy()
                planetaryBall = nil
            end
        end
    end)

    -- 攻击黑洞功能逻辑
    attackToggle.MouseButton1Click:Connect(function()
        local state = attackToggle.Text == "关闭"
        attackToggle.Text = state and "开启" or "关闭"
        attackToggle.BackgroundColor3 = state and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(100, 100, 120)
        
        if state then
            -- 攻击黑洞逻辑
            while attackToggle.Text == "开启" and wait(0.1) do
                for _, part in ipairs(workspace:GetDescendants()) do
                    if part:IsA("BasePart") and not part.Anchored then
                        local targetPos = part.Position + Vector3.new(0, 50, 0)
                        part.Velocity = (targetPos - part.Position).unit * 40
                        
                        -- 检测玩家并甩飞
                        for _, otherPlayer in ipairs(Players:GetPlayers()) do
                            if otherPlayer ~= player and otherPlayer.Character then
                                local rootPart = otherPlayer.Character:FindFirstChild("HumanoidRootPart")
                                if rootPart and (part.Position - rootPart.Position).magnitude < 25 then
                                    part.Velocity = (rootPart.Position - part.Position).unit * 80
                                    local humanoid = otherPlayer.Character:FindFirstChild("Humanoid")
                                    if humanoid then
                                        humanoid:ApplyImpulse((rootPart.Position - part.Position).unit * 40)
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end)

    -- 最小化/恢复
    minimizeBtn.MouseButton1Click:Connect(function()
        isMinimized = not isMinimized
        if isMinimized then
            mainPanel.Visible = false
            infoTag.Visible = false
            createMinimizeStub()
        else
            mainPanel.Visible = true
            infoTag.Visible = true
        end
    end)

    -- 拖拽支持（手机端通过触摸移动）
    local function onDragStarted()
        mainPanel.Draggable = true
    end

    local function onDragEnded()
        mainPanel.Draggable = false
    end

    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            onDragStarted()
        end
    end)

    titleBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            onDragEnded()
        end
    end)
end

-- 最小化后的小按钮
local function createMinimizeStub()
    local stub = Instance.new("TextButton")
    stub.Size = UDim2.new(0, 70, 0, 20)
    stub.Position = UDim2.new(0.85, 0, 0.02, 0)
    stub.BackgroundTransparency = 0.5
    stub.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    stub.Text = "NZ助手"
    stub.TextColor3 = Color3.fromRGB(255, 255, 255)
    stub.Font = Enum.Font.SourceSans
    stub.TextSize = 10
    stub.Parent = gui

    stub.MouseButton1Click:Connect(function()
        stub:Destroy()
        if mainPanel then mainPanel.Visible = true end
        if infoTag then infoTag.Visible = true end
        isMinimized = false
    end)
end

-- 启动脚本
showWelcome()
